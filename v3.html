<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open CDB</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap');
</style>
    <style>
        body { font-family: "Noto Sans", serif; text-align: center; margin: 20px; }
        #chatbox { width: 90%; max-width: 400px; height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin: 20px auto; border-radius: 8px;}
        #userInput { width: 80%; padding: 10px; }
        button, input[type="file"] { padding: 10px; margin: 10px; border-radius: 8px; border: 1px solid #ddd; display: none;}
.btn{
border: 1px solid #666;
background: #ddd;
padding: 5px; border-radius: 8px;
}
input[type="text"]{
margin-bottom: 20px;
border: 1px solid #ddd;
outline: none;
padding: 5px; border-radius: 8px;
}
table{
margin-top: 20px;
border-collapse: collapse;
width: 100%;
}
td, th, tr{
border: 1px solid #ddd;
padding: 8px;
}
        img { max-width: 100px; margin: 5px; border-radius: 8px; float: right;}
        .msg { padding: 5px; border-radius: 8px; word-wrap: break-word; margin: 5px;}
        .user { background: #007bff; color: white; text-align: right; float: right; width: 75%; border: 1px solid #003478;}
        .bot { background: #ddd; text-align: left; float: left; width: 75%; border: 1px solid #666;}
::-moz-selection { /* Code for Firefox */
  color: #fff;
background: #000;
}

::selection {
  color: #fff;
background: #000;
}
.logo{
line-height: 0.75;
{
    </style>
</head>
<body>

    <div class="logo"><h2>Open CDB</h2>
<p>ChatGPT 4o</p></div>
    <div id="chatbox"></div>

    <input type="text" id="userInput" placeholder="Enter text..." />
<span class="btn" onclick="sendMessage()">Send</span>
   <label for="imageInput"><span class="btn">Image</span></label><input type="file" id="imageInput" accept="image/*">
    <br>

<!---<table>
  <tr>
    <th>SCENE 1</th>
    <th>SCENE 2</th>
    <th>SCENE 3</th>
  </tr>
  <tr>
    <td><input type="checkbox" id="vehicle1" name="vehicle1">
<label for="vehicle1">Hook</label><br>
</td>
<td><input type="checkbox" id="vehicle1" name="vehicle1">
<label for="vehicle1"></label><br>
</td>
  </tr>
  <tr>
    <td><input type="checkbox" id="vehicle1" name="vehicle1">
<label for="vehicle1">Day 2</label><br>
</td>
<td><input type="checkbox" id="vehicle1" name="vehicle1">
<label for="vehicle1">Day 2</label><br>
</td>
  </tr>
<tr>
    <td><input type="checkbox" id="vehicle1" name="vehicle1">
<label for="vehicle1">Day 3</label><br>
</td>
<td><input type="checkbox" id="vehicle1" name="vehicle1">
<label for="vehicle1">Day 3</label><br>
</td>
  </tr>
</table>--->
    

    <script>
        const OPENROUTER_API_KEY = "";
        const ELEVENLABS_API_KEY = "sk_5a15bb30273e5a377d3f75c380af82bb4894ad128bf2d855";
        const CLOUDMERSIVE_API_KEY = "a034550d-534d-47ff-82b7-420d89915153";
        const VOICE_ID = "iP95p4xoKVk53GoZ742B"; 

        const chatbox = document.getElementById("chatbox");
        const userInput = document.getElementById("userInput");
getBin("key");
        let chatHistory = [{ role: "system", content: "You are a helpful AI assistant." }];
chatHistory.push({ role: "assistant", content: "Waht code can I generate for you." });

        async function sendMessage() {
userInput.value = `${userInput.value}`;
            const userText = userInput.value.trim();
            if (!userText) return;
            addMessage(userText, "user");

            userInput.value = "";
            chatHistory.push({ role: "user", content: userText });

            const botReply = await getAIResponse();
            addMessage(botReply, "bot");
            chatHistory.push({ role: "assistant", content: botReply });

            textToSpeech(botReply);
        }

        function addMessage(text, sender) {
            const div = document.createElement("div");
            div.textContent = text;
            div.classList.add("msg", sender);
            chatbox.appendChild(div);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        async function getAIResponse() {
            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${OPENROUTER_API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: "openai/gpt-3.5-turbo",
                        messages: chatHistory,
                        max_tokens: 10000
                    })
                });

                const data = await response.json();
                return data.choices[0].message.content.trim();
            } catch (error) {
                return "Sorry, I couldn't process that.";
            }
        }

        async function textToSpeech(text) {
            /*try {
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "xi-api-key": ELEVENLABS_API_KEY
                    },
                    body: JSON.stringify({
                        text: text,
                        model_id: "eleven_multilingual_v2",
                        voice_settings: { stability: 0.75, similarity_boost: 0.75 }
                    })
                });

                const arrayBuffer = await response.arrayBuffer();
                const audioBlob = new Blob([arrayBuffer], { type: 'audio/mpeg' });
                const audioUrl = URL.createObjectURL(audioBlob);
                const audio = new Audio(audioUrl);
                audio.play();
            } catch (error) {
                console.log("TTS Error:", error);
            }*/
        }

        
        document.getElementById("imageInput").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                addImageToChat(e.target.result, "user"); // Show the uploaded image in chat
                detectObjects(file);
            };
            reader.readAsDataURL(file);
        });

        function addImageToChat(imageSrc, sender) {
            const div = document.createElement("div");
            div.classList.add("msg", sender);

            const img = document.createElement("img");
            img.src = imageSrc;
            div.appendChild(img);

            chatbox.appendChild(div);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        async function detectObjects(file) {
            const url = "https://api.cloudmersive.com/image/recognize/describe";
            const formData = new FormData();
            formData.append("imageFile", file);

            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: { "Apikey": CLOUDMERSIVE_API_KEY },
                    body: formData
                });

                const data = await response.json();
                const detectedObjects = data.BestOutcome?.Description || "No objects detected.";

                addMessage(`Detected: ${detectedObjects}`, "bot");
textToSpeech(`${detectedObjects}`)
                chatHistory.push({ role: "user", content: `I uploaded an image.` });

                
                chatHistory.push({ role: "assistant", content: `The image you gave me contains ${detectedObjects}` });

                textToSpeech(botReply);
            } catch (error) {
                
            }
        }

const binUrl = "https://api.jsonbin.io/v3/b/67b8ac7ae41b4d34e497299b";

    const apiKey = "$2a$10$U5S6j0uCuo9SwyRZfdRyfeGMbGwa7zeNMakn/2rw5VnHOUMAdCIx2"; // Your new API key

    // Function to update the JSONBin with new data
    async function updateBin(key, value) {
      try {
        const response = await fetch(binUrl, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Master-Key": apiKey,
          },
          body: JSON.stringify({ [key]: value }),
        });

        const result = await response.json();
        
        console.log("Bin updated:", result);
      } catch (error) {
        console.error("Error updating bin:", error);
        document.getElementById("output").textContent = "Error saving data.";
      }
    }

    // Function to retrieve data from JSONBin
    async function getBin(key) {
      try {
        const response = await fetch(binUrl, {
          method: "GET",
          headers: {
            "X-Master-Key": apiKey,
          },
        });

        const result = await response.json();
        const data = result.record;
        
        if (data[key]) {
           OPENROUTER_API_KEY = `${data[key]}`;
        } else {
        }
      } catch (error) {
    }
    }
    </script>

</body>
</html>
